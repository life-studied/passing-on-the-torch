# 计算机网络

## 2.0.应用层概述

### 1.如何创建一个新的网络应用?

1. 编程

   在不同的端系统上运行 通过网络基础设施提供的服 务，应用进程彼此通信

   如Web: Web 服务器软件与浏览器软件 通信

2. 网络核心中没有应用层软件

   网络核心没有应用层功能

   网络应用只在端系统上存在 ，快速网络应用开发和部署

## 2.1.应用层原理

1. ![](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-08 213251.png)

2. ![屏幕截图 2023-05-08 214233](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-08 214233.png)

3. ![屏幕截图 2023-05-08 214434](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-08 214434.png)

4. ![屏幕截图 2023-05-08 214909](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-08 214909.png)

5. ![](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-08 215326.png)

6. ![屏幕截图 2023-05-09 122716](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-09 122716.png)

7. ![屏幕截图 2023-05-09 122749](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-09 122749.png)

8. ![屏幕截图 2023-05-09 122909](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-09 122909.png)

   ![屏幕截图 2023-05-09 123017](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-09 123017.png)

   ![屏幕截图 2023-05-09 123046](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-09 123046.png)

9. ![屏幕截图 2023-05-09 123131](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-09 123131.png)

   ![屏幕截图 2023-05-09 123159](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-09 123159.png)

   ![屏幕截图 2023-05-09 123243](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-09 123243.png)

   

10. 如何使用传输层提供的服务实现应用

    ![屏幕截图 2023-05-09 123404](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-09 123404.png)

11. ![屏幕截图 2023-05-09 123435](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-09 123435.png)

12. 应用需要传输层提供什么样的服务？ 如何描述传输层的服务?

    ![屏幕截图 2023-05-09 123527](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-09 123527.png)

13. 常见应用对传输服务的要求

    ![屏幕截图 2023-05-09 123633](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-09 123633.png)

14. 】![屏幕截图 2023-05-09 123704](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-09 123704.png)

15. 为什么要有UDP

    ![屏幕截图 2023-05-09 123759](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-09 123759.png)

16. ![屏幕截图 2023-05-09 123828](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-09 123828.png)

17. ![屏幕截图 2023-05-09 123905](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-09 123905.png)

## 2.2 Web与HTTP

1. ![屏幕截图 2023-05-10 135225](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 135225.png)

2. 超文本传输协议 : 文本与文本之间任意指向的关系

   ![屏幕截图 2023-05-10 135426](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 135426.png)

3. Web页面 : 由对象注册的，一个对象只是一个文件.
   多数Web页面含有一个基本的HTML文件

   ![屏幕截图 2023-05-10 135819](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 135819.png)

4. ![屏幕截图 2023-05-10 140452](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 140452.png)

5. ![屏幕截图 2023-05-10 141025](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 141025.png)

6. 响应时间模型

   ![屏幕截图 2023-05-10 141119](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 141119.png)

7. 持久HTPP

   ![屏幕截图 2023-05-10 141230](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 141230.png)

8. ![屏幕截图 2023-05-10 141312](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 141312.png)

   ![屏幕截图 2023-05-10 141348](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 141348.png)

9. ![屏幕截图 2023-05-10 141425](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 141425.png)

   ![屏幕截图 2023-05-10 142438](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 142438.png)

   ![屏幕截图 2023-05-10 142547](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 142547.png)

   ![屏幕截图 2023-05-10 142621](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 142621.png)

10. ![屏幕截图 2023-05-10 142819](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 142819.png)

    ![屏幕截图 2023-05-10 143931](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 143931.png)

    ![屏幕截图 2023-05-10 144023](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 144023.png)

11. Web缓存

    ![屏幕截图 2023-05-10 144131](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 144131.png)

    缓存既是客户端又是 服务器
    通常缓存是由ISP安 装 (大学、公司、居 民区ISP)
    为什么要使用Web缓存 ？
    降低客户端的请求响应时 间
    可以大大减少一个机构内 部网络与Internent接入 链路上的流量
    互联网大量采用了缓存： 可以使较弱的ICP也能够 有效提供内容
    ![屏幕截图 2023-05-10 145654](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 145654.png)

    改进（缓存例子：安装本地缓存）

    ![屏幕截图 2023-05-10 150251](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 150251.png)

12. 条件GET方法

    ![屏幕截图 2023-05-10 151456](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 151456.png)

13. ![屏幕截图 2023-05-10 152006](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 152006.png)

    ![屏幕截图 2023-05-10 152314](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 152314.png)

    ![屏幕截图 2023-05-10 152718](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 152718.png)

14. ![屏幕截图 2023-05-10 152909](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 152909.png)

    邮件服务器
         邮箱中管理和维护发送给用户 的邮件
         输出报文队列保持待发送邮件 报文
         邮件服务器之间的SMTP协议 ：发送email报文
                   客户：发送方邮件服务器
                   服务器：接收端邮件服务 器
    使用TCP在客户端和服务器之间传送报文，端口 号为25
    直接传输：从发送方服务器到接收方服务器
    传输的3个阶段  握手  传输报文  关闭
    命令/响应交互  命令：ASCII文本  响应：状态码和状态信息
    报文必须为7位ASCII码
    ![屏幕截图 2023-05-10 153153](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 153153.png)

14. 总结

    ![屏幕截图 2023-05-10 153816](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 153816.png)

15. 邮件报文格式

    ![屏幕截图 2023-05-10 153948](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 153948.png)

    ![屏幕截图 2023-05-10 154020](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 154020.png)

    ![屏幕截图 2023-05-10 154049](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 154049.png)

    ![屏幕截图 2023-05-10 154116](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 154116.png)

    ![屏幕截图 2023-05-10 154138](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 154138.png)

16. DNS (53端口, 给应用程序应用的程序 )

    ![屏幕截图 2023-05-10 154225](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 154225.png)

    ![屏幕截图 2023-05-10 154249](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 154249.png)

    负载均衡 ： DNS也用于冗余的服务器之间进行负载分配 ， 繁忙的站点被冗余分布在多台服务器上，每台服务器均运行在不同的端系统上，每个都有不同的IP地址。

17. DNS系统需要解决的问题

    ![屏幕截图 2023-05-10 154347](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 154347.png)

    ![屏幕截图 2023-05-10 154408](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 154408.png)

    ![屏幕截图 2023-05-10 154431](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 154431.png)

    ![屏幕截图 2023-05-10 154450](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 154450.png)

    问题2：解析问题-名字服务器(NameServer)

    ![屏幕截图 2023-05-10 154529](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 154529.png)

    ![屏幕截图 2023-05-10 154550](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 154550.png)

    ![屏幕截图 2023-05-10 154615](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 154615.png)

18. 区域名字服务器维护资源记录

    资源记录(resource records)

       作用：维护 域名-IP地址(其它)的映射关系
       位置：Name Server的分布式数据库中
    RR格式: (domain_name, ttl, type,class,Value)

      Domain_name: 域名
      Ttl: time to live : 生存时间(权威，缓冲记录)
      Class 类别 ：对于Internet，值为IN
      Value 值：可以是数字，域名或ASCII串
      Type 类别：资源记录的类型—见下页
    ![屏幕截图 2023-05-10 154615](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 154615.png)

    ![屏幕截图 2023-05-10 154807](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 154807.png)

    ![屏幕截图 2023-05-10 154839](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 154839.png)

    ![屏幕截图 2023-05-10 154909](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 154909.png)

    ![屏幕截图 2023-05-10 154936](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 154936.png)

    ![屏幕截图 2023-05-10 154958](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 154958.png)

19. DNS协议、报文

    ![屏幕截图 2023-05-10 155040](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 155040.png)

    ![屏幕截图 2023-05-10 155100](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 155100.png)

    **提高性能 – > 缓存**

    一旦名字服务器学到了一个映射，就将该映射 缓存起来
     根服务器通常都在本地服务器中缓存着   使得根服务器不用经常被访问
    目的：提高效率   可能存在的问题：如果情况变化，缓存结果和 权威资源记录不一致
    解决方案：TTL（默认2天）

20. 问题3：维护问题：新增一个域

    ![屏幕截图 2023-05-10 155226](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 155226.png)

    ![屏幕截图 2023-05-10 155258](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 155258.png)

21. **P2P**
    纯P2P架构 :  没有（或极少）一直运行的 服务器  任意端系统都可以直接通信 利用peer的服务能力   Peer节点间歇上网，每次IP 地址都有可能变化
    例子:   文件分发 (BitTorrent)   流媒体(KanKan)     VoIP (Skype)
    非结构化P2P ： 集中化目录 ， 完全分布式，混合
    结构化p2p ：DHT（分布式散列表）维护环or树的有序拓扑结构( 不断深入的过程)

![屏幕截图 2023-05-10 155435](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 155435.png)

22. 文件分发

    ​     问题: 从一台服务器分发文件（大小F）到N个peer 需要多少时间？

    ![屏幕截图 2023-05-10 155545](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 155545.png)

23. cs模式

    ![屏幕截图 2023-05-10 155621](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 155621.png)

    ![屏幕截图 2023-05-10 155711](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 155711.png)

    当N足够的大的时候 ，取等号

    P2P模式

    ![屏幕截图 2023-05-10 155808](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 155808.png)

    ![屏幕截图 2023-05-10 155833](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 155833.png)

    BitTorrent

    ![屏幕截图 2023-05-10 155912](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 155912.png)

    ![屏幕截图 2023-05-10 155933](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 155933.png)

    ![屏幕截图 2023-05-10 155959](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 155959.png)

    p2p文件共享

    ![屏幕截图 2023-05-10 160047](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 160047.png)

    两大问题： 如何定位所需资源 如何处理对等方的 加入与离开

    可能的方案 :集中  分散  半分散

24. 集中式目录

    ![屏幕截图 2023-05-10 160202](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 160202.png)

25. 泛洪 (完全分布式)

    ![屏幕截图 2023-05-10 160301](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 160301.png)

    ![屏幕截图 2023-05-10 160327](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 160327.png)

    ![屏幕截图 2023-05-10 160349](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 160349.png)

    ![屏幕截图 2023-05-10 160415](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 160415.png)

26. 利用不匀称性：KaZaA

    ![屏幕截图 2023-05-10 160501](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 160501.png)

27. KaZaA：查询

    ![](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 160547.png)

    ![屏幕截图 2023-05-10 160609](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 160609.png)

28. ![屏幕截图 2023-05-10 161326](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 161326.png)

    由于存储下载视频 是一对一的关系，则下载未免有些慢了，于是就有了存储视频的流化服务.

    多媒体流化服务：DASH

    ![屏幕截图 2023-05-10 161421](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 161421.png)

    ![屏幕截图 2023-05-10 161443](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 161443.png)

    ![屏幕截图 2023-05-10 161507](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 161507.png)

    ![屏幕截图 2023-05-10 161537](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 161537.png)

    ![屏幕截图 2023-05-10 161556](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 161556.png)

    互联网络主机-主机之间的通信作为一种服务向用户提供

    OTT 挑战: 在拥塞的互联网上复制内容 “over the top”

    ![屏幕截图 2023-05-10 161641](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 161641.png)

    1 ： 流量服务器
    2、向本地DNS服务器解析
    3、返回URL
    4、 告诉他离他最近的客户端的ip地址
    6、再由kingCDN 向客户提供流化服务

29. Socket编程

      目标：建立客户机/服务器的应用中的通信运用socket

      socket：相当于应用进程和点对点传输协议之间的一扇门

      socket类型：对应TCP和UDP有两种socket

    ![屏幕截图 2023-05-10 161747](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 161747.png)

    ![屏幕截图 2023-05-10 161822](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 161822.png)

    过程

    ![屏幕截图 2023-05-10 161849](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 161849.png)

    ![屏幕截图 2023-05-10 161913](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 161913.png)

    ![屏幕截图 2023-05-10 161938](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 161938.png)

    ![屏幕截图 2023-05-10 162008](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 162008.png)

    重点理解堵塞 ， 堵塞的时候 可以实现多进程 。OS的内容
    服务器一个端口对应许多个客户端端口，每个都是独立的会话关系，对应不同的socket。老师说过要区分端口和socket的概念
    TCP端口整数代表的是一个会话关系
    TCP ： 四元组 ！ < 1， 2，3， 4>
    一个端口只能被一个服务器进程绑定，可以被多个进程共用。
    端口是可以共用的，而socket的整数值不一样的

    绑定不等于公用

    多个进程可以使用同一个端口进行发送和接收，这就是公用

30. Welcome socket : 返回一个整数

    **socket俩个重要的数据结构**

    ``// IP地址和port捆绑关系的数据结构（标示进程的端节点）`
    `struct sockaddr_in {` 
        `short sin_family; //地址族`
        `u_short sin_port;// port端口`
        `struct in_addr ,sin_addr; //IP 地址`
        `char sin_zero[8]; // align  对齐`
    `};`

    `//数据结构 hostent 域名和IP地址的数据结构`
    `struct hostent {` 
        `char *h_name;//主机域名
        char **h_aliases; //数组存储 主机别名  
        int h_addrtype; 
        int h_length; /*地址长度*/`
        `char **h_addr_list; // 数组存储 IP地址`
        `#define h_addr h_addr_list[0];`
    `};``

31. UDPsocket 编程

      UDP提供的是一种不可靠的数据流传输，传输过程中可能会丢包，接收的时候         顺序也可能被打乱。

    UDP：客户机与服务器之间没有连接

    ​        发送数据前不需要握手

    ​        发送数据包附加IP地址+端口号

    ​        接收方从数据包中提取处IP地址+端口号

    ![屏幕截图 2023-05-10 162428](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-10 162428.png)

32. TCPsocket 编程（TCP提供的是一种可靠的字节流（byte-stream）传输（pipe）。）

    1. 服务器的先行准备
        （1）服务器必须先运行
        （2）服务器需要创建socket来连接客户机

    2. 客户机连接服务器
        （1）客户机需要创建自己的socket，明确服务器进程的IP地址和端口号
        （2）客户机创建socket时，客户机和服务器之间需建立TCP连接

    3. 服务器接收客户机消息
       （1）服务器需创建一个新的socket，为了服务器进程能够和客户机进行通信
             要运行服务器与多个客户机进行通信 
             用源的端口号来区分不同的客户机

       ![屏幕截图 2023-05-18 215303](C:\Users\86178\Pictures\Saved Pictures\屏幕截图 2023-05-18 215303.png)
